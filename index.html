<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sira Kids - L'Aventure</title>
    
    <!-- Outils -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Model Viewer (3D) -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
    <!-- Police Enfant (Fredoka) -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- STYLE ENFANT (CANDY) --- */
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #e0f2fe; /* Bleu ciel doux */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%230ea5e9' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            padding-bottom: 100px;
            user-select: none;
            color: #1e293b;
        }

        .screen { display: none; animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .screen.active { display: block; }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Cartes bloqu√©es */
        .locked { filter: grayscale(100%); opacity: 0.6; pointer-events: none; }

        /* Boutons 3D "Candy" */
        .btn-candy {
            transition: all 0.1s;
            border-bottom-width: 6px;
            cursor: pointer;
        }
        .btn-candy:active {
            transform: translateY(4px);
            border-bottom-width: 0px;
            margin-top: 4px;
        }

        /* Zone de dessin */
        canvas {
            border: 4px dashed #f59e0b;
            border-radius: 20px;
            background-color: white;
            cursor: crosshair;
            touch-action: none;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- HEADER -->
    <div class="fixed top-0 w-full bg-yellow-500 p-3 shadow-md z-50 flex justify-between items-center border-b-4 border-yellow-700 rounded-b-2xl">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-3xl shadow border-2 border-yellow-200">ü¶Å</div>
            <div>
                <h1 class="text-xl font-bold text-white drop-shadow-md leading-none tracking-wide">Sira Kids</h1>
                <div class="text-xs font-bold text-yellow-900 flex items-center gap-1 mt-1 bg-white/30 px-2 py-1 rounded-full w-fit border border-yellow-600/20">
                    <i data-lucide="star" class="w-4 h-4 fill-yellow-700 text-yellow-700"></i> <span id="header-xp">0</span> √âtoiles
                </div>
            </div>
        </div>
        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center border-4 border-yellow-300 text-yellow-700 font-bold shadow-sm text-xl" id="header-avatar">A</div>
    </div>
    <div class="h-28"></div>

    <!-- √âCRAN 1 : LA CARTE -->
    <div id="screen-map" class="screen active p-4 max-w-md mx-auto">
        <div id="course-list" class="flex flex-col items-center gap-8 py-8">
            <!-- Inject√© par JS -->
        </div>
    </div>

    <!-- √âCRAN 2 : PROFIL -->
    <div id="screen-profile" class="screen p-4 max-w-md mx-auto text-center">
        <div class="w-36 h-36 bg-white rounded-full mx-auto mb-4 border-8 border-yellow-400 shadow-xl overflow-hidden p-1">
            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Zayd&backgroundColor=ffdfbf" alt="Avatar" class="w-full h-full rounded-full">
        </div>
        <h2 class="text-3xl font-bold text-blue-800 mb-1" id="profile-name">Zayd</h2>
        <p class="text-slate-500 font-bold mb-8 bg-white px-4 py-1 rounded-full inline-block shadow-sm border-2 border-slate-200">Petit Explorateur</p>

        <div class="bg-white p-6 rounded-3xl shadow-lg border-b-8 border-slate-200">
            <h3 class="text-left font-bold text-xl mb-4 flex items-center gap-2 text-yellow-600">
                <i data-lucide="backpack" class="w-6 h-6"></i> Tes Tr√©sors
            </h3>
            <div class="grid grid-cols-3 gap-3" id="badges-list"></div>
        </div>
        
        <button onclick="resetProgress()" class="mt-8 text-sm text-red-500 underline font-bold bg-white/80 px-4 py-2 rounded-xl">Effacer ma partie</button>
    </div>

    <!-- √âCRAN 3 : LE√áON VERTICALE (CONTENU) -->
    <div id="screen-lesson" class="screen fixed inset-0 z-50 overflow-y-auto hidden bg-orange-50">
        <div class="max-w-lg mx-auto min-h-screen flex flex-col pb-32">
            
            <!-- NAV -->
            <div class="sticky top-0 bg-yellow-500 p-3 shadow-md z-50 flex justify-between items-center border-b-4 border-yellow-700 rounded-b-2xl">
                <button onclick="showScreen('screen-map')" class="bg-black/10 p-2 rounded-xl text-white hover:bg-black/20 transition">
                    <i data-lucide="arrow-left" class="w-8 h-8"></i>
                </button>
                <span class="font-bold text-white text-xl drop-shadow-md" id="lesson-header-title">Mission</span>
                <div class="w-12"></div>
            </div>

            <!-- HERO IMAGE -->
            <div class="w-full h-64 bg-orange-200 flex items-center justify-center relative overflow-hidden shadow-inner mb-6 mx-auto mt-4 rounded-3xl w-11/12 border-4 border-white shadow-xl">
                <img id="lesson-image" src="" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                <h1 class="text-3xl font-bold text-white absolute bottom-4 left-0 right-0 text-center drop-shadow-lg px-4 leading-tight" id="lesson-title">...</h1>
            </div>

            <div class="px-4 flex-grow space-y-8">
                
                <!-- 1. TEXTE -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-slate-200">
                    <p class="text-xl leading-relaxed text-slate-800 font-bold" id="lesson-content">...</p>
                </div>

                <!-- 2. VID√âO DU COURS -->
                <div id="video-zone" class="hidden">
                    <div class="flex items-center gap-2 mb-2 px-2">
                        <span class="bg-blue-600 text-white p-2 rounded-full shadow"><i data-lucide="tv" class="w-5 h-5"></i></span>
                        <h3 class="font-bold text-blue-800 text-lg">REGARDE LE COURS</h3>
                    </div>
                    <div class="bg-black p-2 rounded-3xl shadow-lg border-4 border-blue-300">
                        <video id="video-player" controls class="w-full rounded-2xl">
                            <source src="" type="video/mp4">
                            Ton navigateur ne supporte pas la vid√©o.
                        </video>
                    </div>
                </div>

                <!-- 3. AUDIO (L'HISTOIRE) -->
                <div id="audio-zone" class="hidden">
                    <div class="flex items-center gap-2 mb-2 px-2">
                        <span class="bg-pink-600 text-white p-2 rounded-full shadow"><i data-lucide="headphones" class="w-5 h-5"></i></span>
                        <h3 class="font-bold text-pink-700 text-lg">√âCOUTE L'HISTOIRE</h3>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-pink-200 text-center">
                        <p class="text-slate-700 font-bold mb-4 text-lg" id="audio-title">...</p>
                        <audio id="audio-player" controls class="w-full h-12 rounded-full bg-pink-50">
                            <source src="" type="audio/mpeg">
                        </audio>
                    </div>
                </div>

                <!-- 4. DOCUMENT PDF (LE LIVRE) -->
                <div id="pdf-zone" class="hidden">
                    <div class="flex items-center gap-2 mb-2 px-2">
                        <span class="bg-orange-600 text-white p-2 rounded-full shadow"><i data-lucide="book-open" class="w-5 h-5"></i></span>
                        <h3 class="font-bold text-orange-700 text-lg">D√âCOUVRE LE LIVRE</h3>
                    </div>
                    <div class="bg-white p-2 rounded-3xl shadow-lg border-b-4 border-orange-200">
                        <div class="w-full h-64 bg-slate-100 rounded-2xl overflow-hidden border-2 border-slate-200 relative">
                            <iframe id="pdf-viewer" src="" class="w-full h-full"></iframe>
                            <a id="pdf-link" href="" target="_blank" class="absolute bottom-2 right-2 bg-orange-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow hover:bg-orange-600 flex items-center gap-1">
                                <i data-lucide="maximize" class="w-3 h-3"></i> Ouvrir le PDF
                            </a>
                        </div>
                    </div>
                </div>

                <!-- 5. JEU -->
                <div id="game-zone" class="hidden">
                    <div class="flex items-center gap-2 mb-2 px-2">
                        <span class="bg-green-600 text-white p-2 rounded-full shadow"><i data-lucide="gamepad-2" class="w-5 h-5"></i></span>
                        <h3 class="font-bold text-green-700 text-lg">LE JEU</h3>
                    </div>
                    <div class="bg-stone-900 rounded-3xl overflow-hidden border-4 border-stone-700 shadow-xl relative aspect-video">
                        <iframe id="game-frame" src="" class="w-full h-full border-none bg-stone-800"></iframe>
                    </div>
                    <p class="text-center text-xs text-slate-400 mt-2 font-bold uppercase tracking-widest">
                        <i data-lucide="keyboard" class="w-3 h-3 inline"></i> Espace pour Sauter
                    </p>
                </div>

                <!-- 6. ACTIVIT√â DESSIN -->
                <div id="drawing-zone" class="hidden">
                    <div class="flex items-center gap-2 mb-2 px-2">
                        <span class="bg-indigo-600 text-white p-2 rounded-full shadow"><i data-lucide="pencil" class="w-5 h-5"></i></span>
                        <h3 class="font-bold text-indigo-700 text-lg">DESSINE</h3>
                    </div>
                    
                    <div class="bg-white p-2 rounded-3xl shadow-lg border-b-4 border-green-200">
                        <div class="relative w-full h-64 bg-slate-50 rounded-2xl overflow-hidden border-2 border-dashed border-slate-400 touch-none">
                            <div id="drawing-bg" class="absolute inset-0 bg-contain bg-center bg-no-repeat opacity-30 pointer-events-none"></div>
                            <canvas id="drawing-canvas" class="relative z-10 w-full h-full"></canvas>
                        </div>
                        
                        <div class="flex justify-center gap-3 mt-4 mb-2">
                            <button onclick="setColor('#ef4444')" class="w-12 h-12 bg-red-500 rounded-full border-4 border-white shadow-md ring-2 ring-transparent hover:ring-red-300 transition transform hover:scale-110"></button>
                            <button onclick="setColor('#3b82f6')" class="w-12 h-12 bg-blue-600 rounded-full border-4 border-white shadow-md ring-2 ring-transparent hover:ring-blue-300 transition transform hover:scale-110"></button>
                            <button onclick="setColor('#16a34a')" class="w-12 h-12 bg-green-600 rounded-full border-4 border-white shadow-md ring-2 ring-transparent hover:ring-green-300 transition transform hover:scale-110"></button>
                            <button onclick="clearCanvas()" class="ml-2 bg-slate-200 text-slate-600 p-3 rounded-xl font-bold shadow-sm border-b-4 border-slate-300 active:border-b-0 active:translate-y-1"><i data-lucide="eraser"></i></button>
                        </div>
                    </div>
                </div>

                <!-- 7. R√âCOMPENSE 3D -->
                <div id="reward-zone" class="hidden">
                    <div class="flex items-center gap-2 mb-2 px-2">
                        <span class="bg-purple-600 text-white p-2 rounded-full shadow"><i data-lucide="gift" class="w-5 h-5"></i></span>
                        <h3 class="font-bold text-purple-700 text-lg">TON CADEAU</h3>
                    </div>
                    <div class="bg-white p-2 rounded-3xl border-b-4 border-purple-200 shadow-lg h-64 relative">
                        <model-viewer 
                            id="reward-model"
                            src="" 
                            alt="Tr√©sor"
                            auto-rotate camera-controls shadow-intensity="1"
                            style="width: 100%; height: 100%;"
                        >
                        </model-viewer>
                        <div class="absolute bottom-2 right-2 bg-purple-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow">3D</div>
                    </div>
                </div>

                <!-- BOUTON FIN -->
                <button onclick="completeLesson()" class="btn-candy w-full bg-green-500 text-white py-4 rounded-3xl font-bold text-xl shadow-xl border-green-700 flex items-center justify-center gap-2 mt-8">
                    <i data-lucide="check-circle" class="w-8 h-8"></i> J'AI FINI !
                </button>
            </div>
        </div>
    </div>

    <!-- MENU BAS -->
    <div class="fixed bottom-4 left-4 right-4 bg-white border-2 border-slate-100 flex justify-around p-2 z-40 shadow-2xl rounded-3xl">
        <button onclick="showScreen('screen-map')" class="flex flex-col items-center w-20 p-2 rounded-2xl transition text-yellow-600 bg-yellow-50">
            <i data-lucide="map" class="w-8 h-8"></i>
            <span class="text-xs font-bold mt-1">CARTE</span>
        </button>
        <button onclick="showScreen('screen-profile')" class="flex flex-col items-center w-20 p-2 rounded-2xl transition text-slate-400 hover:text-blue-600 hover:bg-blue-50">
            <i data-lucide="user" class="w-8 h-8"></i>
            <span class="text-xs font-bold mt-1">MOI</span>
        </button>
    </div>

    <!-- LOGIQUE JS -->
    <script>
        const COURSES = [
            {
                id: 1,
                title: "LES 2 EMPIRES",
                desc: "Il y a tr√®s longtemps, deux grands rois voulaient tout commander. Regarde !",
                image: "https://images.unsplash.com/photo-1545194453-27c9197c320e?q=80",
                color: "bg-orange-600",
                
                // VIDE ICI
                videoUrl: "", 
                audioUrl: "",
                audioTitle: "",
                pdfUrl: "",
                gameUrl: "",
                drawingBg: "",
                reward: "Bouclier",
                model3d: ""
            },
            {
                id: 2,
                title: "B√âDOUINS ET S√âDENTAIRES",
                desc: "Certains habitent dans des maisons, d'autres sous des tentes. √âcoute l'histoire !",
                image: "https://images.unsplash.com/photo-1595267660232-4752b07e594d?q=80",
                color: "bg-yellow-600",
                
                // >>>>> TOUT EST ICI (LE√áON 2) <<<<<
                videoUrl: "cours_video_1.mp4", 
                audioUrl: "audio_sedan_et_bedou.mp3",
                audioTitle: "SEDAN ET BEDOU - Histoire audio",
                pdfUrl: "Ville_et_Deserts.pdf",
                gameUrl: "Jeu_Sira/index.html",
                
                drawingBg: "https://img.freepik.com/vecteurs-libre/fond-paysage-desertique-plat-organique_23-2149420847.jpg",
                reward: "Tente",
                model3d: "https://models.readyplayer.me/64f0ea507205d8f6345f7f32.glb"
            },
            {
                id: 3,
                title: "La Grotte",
                desc: "Chut... √âcoute le silence. Quelque chose arrive.",
                image: "https://images.unsplash.com/photo-1518263726702-60298a08730b?q=80",
                color: "bg-purple-700",
                videoUrl: "", audioUrl: "", pdfUrl: "", gameUrl: "",
                reward: "√âtoile"
            }
        ];

        // ON D√âBLOQUE LE NIVEAU 2 PAR D√âFAUT POUR QUE TU PUISSES CLIQUER
        let userProgress = JSON.parse(localStorage.getItem('sirakids_progress')) || { xp: 0, unlockedLevel: 2, badges: [] };

        lucide.createIcons();
        renderMap();
        updateUI();

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            const bottomMenu = document.querySelector('.fixed.bottom-4');
            bottomMenu.style.display = (screenId === 'screen-lesson') ? 'none' : 'flex';
            window.scrollTo(0, 0);
            
            document.querySelectorAll('video').forEach(vid => vid.pause());
            document.querySelectorAll('audio').forEach(aud => aud.pause());
        }

        function updateUI() {
            document.getElementById('header-xp').innerText = userProgress.xp;
            const badgesContainer = document.getElementById('badges-list');
            if (userProgress.badges.length > 0) {
                badgesContainer.innerHTML = userProgress.badges.map(b => 
                    `<div class="bg-blue-100 p-2 rounded-2xl border-b-4 border-blue-300 aspect-square flex flex-col items-center justify-center text-center shadow-sm">
                        <span class="text-3xl mb-1">üéÅ</span>
                        <span class="text-xs font-bold text-blue-900">${b}</span>
                    </div>`
                ).join('');
            } else {
                badgesContainer.innerHTML = `<p class="col-span-3 text-sm text-slate-400 italic">Tes tr√©sors appara√Ætront ici...</p>`;
            }
        }

        function renderMap() {
            const list = document.getElementById('course-list');
            list.innerHTML = "";

            COURSES.forEach((course, index) => {
                const isLocked = (index + 1) > userProgress.unlockedLevel;
                const isDone = (index + 1) < userProgress.unlockedLevel;
                
                let btnColor = isLocked ? 'bg-slate-300 border-slate-400 text-slate-500' : 
                               (isDone ? 'bg-yellow-400 border-yellow-600 text-white' : 'bg-green-500 border-green-700 text-white animate-bounce');
                
                let icon = isLocked ? 'lock' : (isDone ? 'check' : 'star');
                let margin = index % 2 === 0 ? 'mr-auto' : 'ml-auto';
                if(index % 2 !== 0) margin += " translate-x-8";
                else margin += " -translate-x-8";

                const div = document.createElement('div');
                div.className = `relative flex flex-col items-center ${margin}`;
                div.onclick = () => !isLocked && openLesson(course);
                
                div.innerHTML = `
                    <div class="w-24 h-24 rounded-full border-b-8 shadow-xl flex items-center justify-center cursor-pointer transition transform active:scale-95 ${btnColor}">
                        <i data-lucide="${icon}" class="w-10 h-10"></i>
                    </div>
                    <div class="mt-2 bg-white/90 px-3 py-1 rounded-xl font-bold text-slate-700 shadow-md text-sm backdrop-blur-sm border border-slate-200">
                        ${course.title}
                    </div>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        function openLesson(course) {
            document.getElementById('lesson-title').innerText = course.title;
            document.getElementById('lesson-header-title').innerText = `Niveau ${course.id}`;
            document.getElementById('lesson-content').innerText = course.desc;
            document.getElementById('lesson-image').src = course.image;
            
            // VIDEO
            const videoZone = document.getElementById('video-zone');
            const vidPlayer = document.getElementById('video-player');
            if (course.videoUrl) {
                videoZone.classList.remove('hidden');
                vidPlayer.src = course.videoUrl;
            } else { videoZone.classList.add('hidden'); }

            // AUDIO
            const audioZone = document.getElementById('audio-zone');
            const audPlayer = document.getElementById('audio-player');
            const audTitle = document.getElementById('audio-title');
            if (course.audioUrl) {
                audioZone.classList.remove('hidden');
                audPlayer.src = course.audioUrl;
                audTitle.innerText = course.audioTitle || "√âcoute l'histoire";
            } else { audioZone.classList.add('hidden'); }

            // PDF
            const pdfZone = document.getElementById('pdf-zone');
            const pdfViewer = document.getElementById('pdf-viewer');
            const pdfLink = document.getElementById('pdf-link');
            if (course.pdfUrl) {
                pdfZone.classList.remove('hidden');
                pdfViewer.src = course.pdfUrl;
                pdfLink.href = course.pdfUrl;
            } else { pdfZone.classList.add('hidden'); }

            // JEU
            const gameZone = document.getElementById('game-zone');
            const gameFrame = document.getElementById('game-frame');
            if (course.gameUrl) {
                gameZone.classList.remove('hidden');
                gameFrame.src = course.gameUrl;
            } else { 
                gameZone.classList.add('hidden'); 
                gameFrame.src = "";
            }

            // DESSIN
            const drawingZone = document.getElementById('drawing-zone');
            if (course.drawingBg) {
                drawingZone.classList.remove('hidden');
                document.getElementById('drawing-bg').style.backgroundImage = `url('${course.drawingBg}')`;
                setTimeout(initCanvas, 500); 
            } else { drawingZone.classList.add('hidden'); }

            // RECOMPENSE
            const rewardZone = document.getElementById('reward-zone');
            if (course.model3d) {
                rewardZone.classList.remove('hidden');
                document.getElementById('reward-model').src = course.model3d;
            } else { rewardZone.classList.add('hidden'); }

            showScreen('screen-lesson');
            lucide.createIcons();
        }

        function completeLesson() {
            const currentLevel = userProgress.unlockedLevel;
            const course = COURSES[currentLevel - 1]; 

            if (course) {
                userProgress.unlockedLevel++;
                userProgress.xp += 10;
                if (!userProgress.badges.includes(course.reward)) userProgress.badges.push(course.reward);
                localStorage.setItem('sirakids_progress', JSON.stringify(userProgress));
                alert(`üéâ BRAVO !\n\nTu as gagn√© : ${course.reward}`);
            }
            updateUI(); renderMap(); showScreen('screen-map');
        }

        function resetProgress() {
            if(confirm("Tu veux effacer ta partie ?")) { 
                localStorage.removeItem('sirakids_progress'); 
                location.reload(); 
            }
        }

        // --- CANVAS DESSIN ---
        let canvas, ctx, drawing = false;
        let currentColor = "#ef4444";

        function initCanvas() {
            canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            ctx = canvas.getContext('2d');
            ctx.lineWidth = 12; // Trait tr√®s √©pais
            ctx.lineCap = 'round';
            ctx.strokeStyle = currentColor;

            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDraw);
            canvas.addEventListener('mouseleave', stopDraw);
            canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e.touches[0]); }, {passive: false});
            canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); }, {passive: false});
            canvas.addEventListener('touchend', stopDraw);
        }

        function startDraw(e) {
            drawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }
        function draw(e) {
            if(!drawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }
        function stopDraw() { drawing = false; }
        function setColor(c) { currentColor = c; if(ctx) ctx.strokeStyle = c; }
        function clearCanvas() { if(ctx) ctx.clearRect(0,0,canvas.width,canvas.height); }

    </script>
</body>
</html>
